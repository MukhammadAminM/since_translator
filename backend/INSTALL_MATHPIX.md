# Настройка Mathpix API для распознавания математических формул

Mathpix API позволяет точно распознавать математические формулы из изображений и конвертировать их в LaTeX формат.

## Шаг 1: Регистрация и получение API ключей

1. Перейдите на сайт Mathpix: https://mathpix.com/
2. Зарегистрируйте аккаунт или войдите в существующий
3. Перейдите в раздел API: https://accounts.mathpix.com/
4. Создайте новое приложение (Application)
5. Скопируйте следующие ключи:
   - **App ID** (app_id)
   - **App Key** (app_key)

## Шаг 2: Добавление ключей в .env файл

Откройте файл `.env` в корне проекта `backend/` и добавьте:

```env
MATHPIX_APP_ID=your_app_id_here
MATHPIX_APP_KEY=your_app_key_here
```

**Пример:**
```env
MATHPIX_APP_ID=my_app_12345
MATHPIX_APP_KEY=abc123def456ghi789
```

## Шаг 3: Установка зависимостей

Убедитесь, что установлена библиотека `requests`:

```bash
pip install requests
```

Или установите все зависимости:

```bash
pip install -r requirements.txt
```

## Шаг 4: Проверка работы

После настройки API ключей, система автоматически будет использовать Mathpix для распознавания формул при обработке PDF файлов с изображениями.

### Лимиты и тарифы

- **Бесплатный план**: 1000 запросов в месяц
- **Платные планы**: от $0.004 за запрос

Подробнее о тарифах: https://mathpix.com/pricing

### Как это работает

1. При обработке PDF с изображениями система использует Tesseract OCR для обычного текста
2. Когда обнаруживается потенциальная формула (строка с математическими символами), система автоматически отправляет изображение в Mathpix API
3. Mathpix распознает формулу и возвращает её в формате LaTeX
4. Формула заменяется на правильную LaTeX версию: `\[формула\]`

### Примеры распознавания

**До (испорченный OCR):**
```
Av = Isp + go -1n (=)
mf
```

**После (Mathpix):**
```
\[\Delta v = I_{sp} \cdot g_0 \cdot \ln\left(\frac{m_0}{m_f}\right)\]
```

## Устранение проблем

### Ошибка: "Mathpix API не настроен"

- Проверьте, что ключи добавлены в `.env` файл
- Убедитесь, что имена переменных правильные: `MATHPIX_APP_ID` и `MATHPIX_APP_KEY`
- Перезапустите сервер после добавления ключей

### Ошибка: "Mathpix API ошибка 401"

- Проверьте правильность API ключей
- Убедитесь, что ключи не истекли
- Проверьте лимиты использования на сайте Mathpix

### Ошибка: "Mathpix API timeout"

- Проверьте интернет-соединение
- Попробуйте позже (возможны временные проблемы с API)

## Альтернативы

Если Mathpix недоступен, система продолжит работать с обычным Tesseract OCR, но формулы могут быть менее точными.

