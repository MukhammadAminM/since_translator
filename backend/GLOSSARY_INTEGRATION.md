# Интеграция глоссария в систему перевода

## Обзор

Глоссарий полностью интегрирован в систему перевода. При переводе текста система автоматически:

1. **Загружает глоссарии** для всех поддерживаемых языков (русский, арабский, китайский)
2. **Находит релевантные термины** в переводимом тексте
3. **Добавляет термины в промпт** для AI модели, чтобы обеспечить точный перевод

## Как это работает

### 1. Загрузка глоссариев

При инициализации `TranslationService` автоматически создается `GlossaryManager`, который загружает все доступные глоссарии из папки `backend/glossary/`:

- `glossary_russian_to_en.json` - 628 терминов
- `glossary_arabic_to_en.json` - 305 терминов  
- `glossary_chinise_to_en.json` - 548 терминов

### 2. Умный поиск терминов

При переводе текста система:

1. Анализирует переводимый текст
2. Находит термины из глоссария, которые встречаются в тексте
3. Добавляет только релевантные термины в промпт (до 200 терминов)

Это позволяет:
- ✅ Использовать точные переводы из глоссария
- ✅ Не перегружать промпт всеми терминами
- ✅ Улучшить качество перевода специализированных терминов

### 3. Форматирование для AI

Термины форматируются в удобном для AI формате:

```
IMPORTANT: Use these exact translations from the glossary when these terms appear in the text:

- Универсальный ракетный модуль (УРМ) = Universal rocket module (URM)
- УРМ-1 = Universal rocket module-1
- Баллистическая ракета = Ballistic missile

Note: The full glossary contains 628 terms. Always use exact translations from the glossary for any matching terms.
```

## Использование

### Автоматическое использование

Глоссарий используется автоматически при каждом переводе через API:

```python
# В translator.py
translated_text = await translator_service.translate(
    text="Ракета УРМ-1 запущена",
    source_lang="ru",
    target_lang="en",
    model="engineering"
)
```

Система автоматически:
1. Найдет термин "УРМ-1" в тексте
2. Добавит его перевод в промпт
3. AI модель использует точный перевод из глоссария

### Ручное использование (для отладки)

```python
from services.glossary_manager import GlossaryManager

gm = GlossaryManager()

# Получить все термины для языка
glossary = gm.get_glossary_for_lang("ru")

# Найти релевантные термины в тексте
relevant = gm._find_relevant_terms(
    "Ракета УРМ-1 запущена",
    source_lang="ru",
    max_terms=10
)

# Получить форматированный глоссарий для промпта
summary = gm.get_glossary_summary(
    source_lang="ru",
    text="Ракета УРМ-1 запущена",
    max_terms=200
)
```

## Структура глоссария

Каждый термин в глоссарии имеет следующую структуру:

```json
{
  "урм": {
    "source": "УРМ",
    "target": "Universal rocket module",
    "source_abbr": "УРМ",
    "target_abbr": "URM"
  }
}
```

- `source` - исходный термин (как он написан)
- `target` - перевод термина
- `source_abbr` - аббревиатура на исходном языке (если есть)
- `target_abbr` - аббревиатура на целевом языке (если есть)

## Обновление глоссария

Для обновления глоссария:

1. Добавьте новые файлы в папку `backend/glossary/{language}/`
2. Запустите скрипт пересборки:
   ```bash
   python build_glossary.py
   ```
3. Перезапустите сервер FastAPI

## Проверка работы

При запуске сервера вы должны увидеть сообщения:

```
✅ Загружен глоссарий для ru: 628 терминов
✅ Загружен глоссарий для ar: 305 терминов
✅ Загружен глоссарий для zh: 548 терминов
```

Если глоссарии не загружаются, проверьте:
- Существуют ли JSON файлы в `backend/glossary/`
- Правильный ли путь к глоссарию (автоматически определяется относительно `glossary_manager.py`)

## Преимущества

1. **Точность** - Использование точных переводов из глоссария
2. **Консистентность** - Одинаковые термины переводятся одинаково
3. **Эффективность** - Добавляются только релевантные термины
4. **Масштабируемость** - Легко добавлять новые термины

